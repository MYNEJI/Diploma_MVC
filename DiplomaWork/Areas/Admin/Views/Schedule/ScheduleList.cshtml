@using Diploma.Models.Enums;
@model Dictionary<WeekDays, List<Group>>

<h2>Schedule for Classroom @ViewBag.ClassroomId</h2>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Time</th>
            @foreach (var day in Enum.GetValues(typeof(Diploma.Models.Enums.WeekDays)))
            {
                <th>@day</th>
            }
        </tr>
    </thead>
    <tbody>
        @{
            // Группируем расписание по времени начала занятий
            var timeGroups = Model.Values
                .SelectMany(g => g) // Извлекаем все группы
                .GroupBy(g => TimeSpan.Parse(g.StartTime)) // Группируем по времени начала
                .OrderBy(t => t.Key); // Сортируем по времени
        }
        @foreach (var timeGroup in timeGroups) // Переместить сюда, чтобы использовать timeGroup
        {
            <tr>
                <td>@timeGroup.Key</td>
                @foreach (var day in Enum.GetValues(typeof(Diploma.Models.Enums.WeekDays)))
                {
                    // Находим занятия для текущего дня и времени
                    var groupsForDay = Model[(WeekDays)day]
                        .Where(g => TimeSpan.Parse(g.StartTime) == timeGroup.Key)
                        .OrderBy(g => g.Name) // Дополнительно сортируем по имени группы
                        .ToList();

                   <td style="vertical-align: top;">
                       @if (groupsForDay.Any())
                       {
                           foreach (var group in groupsForDay)
                           {
                               <strong>@group.Name</strong><br />
                               @group.Subject.Title<br />
                               <small>@group.SubjectTeacher.FullName</small><br />
                               <small>@group.StartTime - @group.EndTime</small><br />
                               <hr />
                           }
                       }
                       else
                       {
                           <span>—</span>
                       }
                   </td>
                }
            </tr>
        }
    </tbody>
</table>

<a asp-action="Index" class="btn btn-secondary">Back to List</a>
